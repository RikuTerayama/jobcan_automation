<!DOCTYPE html>
<html lang="ja">
<head>
    {% set page_title = '画像ユーティリティガイド | Automation Hub' %}
    {% include 'includes/head_meta.html' %}
    {% block description_meta %}
        <meta name="description" content="画像ユーティリティの使い方ガイド。透過PNG→白背景JPEG変換、余白トリム、縦横比統一、枠・余白・角丸、背景除去の方法を詳しく解説。">
    {% endblock %}
    <style>
        body { font-family: 'Noto Sans JP', 'Helvetica Neue', 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #121212 0%, #1A1A1A 50%, #0F0F0F 100%); min-height: 100vh; color: #FFFFFF; line-height: 1.8; }
        .container { max-width: 1000px; margin: 0 auto; background: linear-gradient(145deg, #1E1E1E 0%, #2A2A2A 100%); border-radius: 20px; padding: 50px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5); }
        h1 { font-size: 2.5em; margin-bottom: 30px; color: #FFFFFF; }
        h2 { font-size: 1.8em; margin-top: 40px; margin-bottom: 20px; color: #FFFFFF; border-bottom: 2px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; }
        h3 { font-size: 1.4em; margin-top: 30px; margin-bottom: 15px; color: #4A9EFF; }
        p, li { color: rgba(255, 255, 255, 0.9); margin-bottom: 15px; font-size: 1.05em; }
        ul, ol { padding-left: 30px; }
        .step-box { background: rgba(74, 158, 255, 0.1); border-left: 4px solid #4A9EFF; padding: 25px; margin: 30px 0; border-radius: 8px; }
        .step-box h3 { margin-top: 0; }
        .info-box { background: rgba(40, 167, 69, 0.1); border-left: 4px solid #28A745; padding: 20px; margin: 25px 0; border-radius: 8px; }
        .warning-box { background: rgba(220, 53, 69, 0.1); border-left: 4px solid #DC3545; padding: 20px; margin: 25px 0; border-radius: 8px; }
        .tip-box { background: rgba(255, 193, 7, 0.1); border-left: 4px solid #FFC107; padding: 20px; margin: 25px 0; border-radius: 8px; }
        .nav-links { display: flex; gap: 20px; margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.2); flex-wrap: wrap; }
        .nav-link { display: inline-block; padding: 15px 30px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 10px; color: #FFFFFF; text-decoration: none; transition: all 0.3s; }
        .nav-link:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-2px); }
        a { color: #4A9EFF; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    {% include 'includes/header.html' %}
    {% include 'includes/breadcrumb.html' %}
    <div class="container">
        <h1>✨ 画像ユーティリティガイド</h1>
        <p><strong>できること:</strong> 透過PNG→白背景JPEG変換、余白トリム、縦横比統一（1:1/4:5/16:9等）、枠・余白・角丸の付与、背景除去。ブラウザ内で完結し、画像は当サーバーに送信されません。</p>
        <p><strong>想定ユーザー:</strong> EC・SNS運用、デザイナー、マーケターなど、商品画像の統一や投稿用画像の整形が必要な方。</p>

        <h2>このツールで解決できる課題</h2>
        <ul>
            <li>透過PNGを白背景のJPEGに変換したい</li>
            <li>画像の余白を自動でトリムしたい</li>
            <li>複数の画像を同じ縦横比に統一したい</li>
            <li>画像に枠・余白・角丸を付けて体裁を揃えたい</li>
            <li>画像の背景を自動で除去したい</li>
        </ul>

        <h2>主要機能</h2>
        <ul>
            <li><strong>透過→白背景変換</strong>: 透過PNGを白背景のJPEGに変換</li>
            <li><strong>余白トリム</strong>: 画像の余白を自動検出してトリム</li>
            <li><strong>縦横比統一</strong>: 指定した縦横比に合わせて背景を追加</li>
            <li><strong>枠・余白・角丸</strong>: 画像周りの余白（px）、角丸、枠（ボーダー）を指定して一括適用</li>
            <li><strong>背景除去</strong>: AIを使用した自動背景除去</li>
        </ul>

        <h2>使い方の流れ（4ステップ）</h2>
        <div class="step-box">
            <h3>ステップ1: 機能を選択</h3>
            <p><a href="/tools/image-cleanup">画像ユーティリティ</a>にアクセスし、使用したい機能を選択します（透過→白背景、余白トリム、縦横比統一、背景除去）。</p>
        </div>
        <div class="step-box">
            <h3>ステップ2: 画像ファイルを選択</h3>
            <p>処理したい画像ファイルを選択します。複数ファイルの同時処理に対応しています。</p>
        </div>
        <div class="step-box">
            <h3>ステップ3: オプションを設定</h3>
            <p>各機能に応じたオプションを設定します（背景色、トリム感度、縦横比、枠・余白・角丸など）。</p>
        </div>
        <div class="step-box">
            <h3>ステップ4: 処理を実行してダウンロード</h3>
            <p>「処理を開始」ボタンをクリックし、完了後に結果をダウンロードします。</p>
        </div>

        <h2>入出力仕様</h2>
        <h3>対応入力形式</h3>
        <ul>
            <li>PNG（.png）</li>
            <li>JPEG（.jpg, .jpeg）</li>
            <li>WebP（.webp）</li>
        </ul>
        <h3>出力形式</h3>
        <ul>
            <li>JPEG（透過→白背景変換時）</li>
            <li>PNG（その他の処理時）</li>
        </ul>
        <h3>制限事項（実装に基づく）</h3>
        <ul>
            <li>通常モード: 最大50ファイル、1ファイル20MB、合計200MBまで（<code>templates/tools/image-cleanup.html</code> の validateFiles）</li>
            <li>背景除去モード: 最大20ファイル、1ファイル20MB、合計100MBまで（処理負荷のため制限が厳しめ）</li>
            <li>最大ピクセル数: 80,000,000（<code>static/js/image-cleanup.js</code> の MAX_PIXELS）</li>
            <li>枠・余白・角丸: 余白0〜200px、角丸0〜500px、枠幅0〜50px。適用順は余白→角丸→枠です。</li>
        </ul>

        <div class="warning-box">
            <strong>⚠️ 背景除去について</strong>
            <p>背景除去は @imgly/background-removal をCDNから読み込み、ブラウザ内で実行します。初回はライブラリのダウンロードで時間がかかることがあります。</p>
        </div>

        <h2 id="data-handling">データの取り扱い</h2>
        <p>当ツールでは、画像のアップロード・当サーバーへの保存は行いません。</p>
        <ul>
            <li><strong>アップロード</strong>: 行いません。処理はブラウザ内で完結します。根拠: <code>app.py</code> に <code>/tools/image-cleanup</code> 向けのファイル受信ルートは存在せず、<code>templates/tools/image-cleanup.html</code> および <code>static/js/image-cleanup.js</code> でクライアント側のみで処理しています。</li>
            <li><strong>背景除去</strong>: CDNから読み込んだライブラリによりブラウザ内で実行されます。画像データを当サーバーに送信する処理はありません。</li>
        </ul>
        <p>詳細は<a href="/privacy">プライバシーポリシー</a>をご確認ください。</p>

        <h2 id="faq">よくある質問（FAQ）</h2>
        {% set faq_list = [
            {"q": "画像ユーティリティでサーバーに画像がアップロードされますか？", "a": "いいえ。すべてブラウザ内で処理され、画像データは当サーバーに送信されません。app.py に /tools/image-cleanup 向けのアップロードルートはありません。"},
            {"q": "透過PNGを白背景JPEGに変換できますか？", "a": "はい。透過→白背景変換機能で、透過部分を白にしてJPEGで出力できます。"},
            {"q": "背景除去は自動でできますか？", "a": "はい。背景除去で画像を選択すると、ブラウザ内で自動検出・除去されます。複雑な背景は完全に除去できない場合があります。"},
            {"q": "余白トリムがうまくいきません。", "a": "画像の端にノイズやグラデーションがあると検出がずれることがあります。感度を調整するか、事前に画像を整えてからお試しください。"},
            {"q": "縦横比を統一できますか？", "a": "はい。縦横比統一で 1:1、4:5、16:9 などを指定し、はみ出し部分はトリム、足りない部分は背景で埋めて出力できます。"},
            {"q": "枠・余白・角丸は付けられますか？", "a": "はい。処理設定の「枠・余白・角丸」で余白（px）、角丸（px）、枠の幅・色、余白・角の背景色を指定できます。0の場合は変更なしです。出力形式は従来どおりPNG/JPEG/WebPです。"},
            {"q": "背景除去が遅いです。", "a": "高解像度だと処理に時間がかかります。事前に画像一括変換などでリサイズしてから背景除去すると高速化できます。"},
            {"q": "何枚まで一度に処理できますか？", "a": "通常は最大50ファイル、背景除去時は20ファイルまでです。1ファイル20MBまで。合計は通常200MB、背景除去時100MBまでです。"}
        ] %}
        <div class="faq-list">
            {% for item in faq_list %}
            <div class="faq-item" style="margin-bottom: 24px;">
                <h3 style="font-size: 1.1em; margin-bottom: 8px;">Q. {{ item.q }}</h3>
                <p style="margin: 0; padding-left: 1em;">A. {{ item.a }}</p>
            </div>
            {% endfor %}
        </div>

        <h2>トラブルシューティング</h2>
        <ul>
            <li><strong>「画像サイズが大きすぎます」</strong>: 幅×高さが8,000万ピクセルを超えています。事前にリサイズしてからお試しください。</li>
            <li><strong>背景除去でメモリエラーになる</strong>: ファイル数や解像度を減らしてください。20ファイル・20MB以内を目安に。</li>
            <li><strong>余白トリムで切りすぎる・足りない</strong>: 感度（しきい値）を調整するか、画像のコントラストを確認してください。</li>
            <li><strong>透過→白背景でにじむ</strong>: 元画像のエッジがぼやけていると白背景にした際ににじむことがあります。できるだけくっきりした透過PNGをご利用ください。</li>
            <li><strong>枠・角丸を付けても変化がない</strong>: 余白・角丸・枠のいずれも0より大きい値を指定してください。適用順は余白→角丸→枠です。JPEG出力で「透明」を選んだ場合、角部分は白で出力されます。</li>
            <li><strong>ダウンロードが始まらない</strong>: ブラウザのポップアップブロックを確認し、個別ダウンロードでも試してください。</li>
        </ul>

        {% set tool_path = '/tools/image-cleanup' %}
        {% set tool_name = '画像ユーティリティ' %}
        {% include 'guide/_partials/guide_related_links.html' %}

        <div class="nav-links">
            <a href="/tools/image-cleanup" class="nav-link">← 画像ユーティリティに戻る</a>
            <a href="/tools" class="nav-link">← ツール一覧へ</a>
            <a href="/guide/minutes" class="nav-link">次のガイド: 議事録整形 →</a>
        </div>
    </div>
    {% include 'guide/_partials/guide_faq_jsonld.html' %}
    {% include 'includes/footer.html' %}
</body>
</html>
