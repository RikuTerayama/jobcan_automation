# PDFユーティリティ モード切替ファイル維持 動作確認メモ

**対応日**: 2026-02-10  
**対応内容**: 操作モード変更時に選択ファイルを維持し、モード変更後もファイル追加を常に可能にした。

---

## 再現ステップと期待結果

| # | 手順 | 期待結果 |
|---|------|----------|
| 1 | `/tools/pdf` を開く。PDFを2つ追加（ドラッグ&ドロップまたはファイル選択） | ファイル一覧に2件表示される |
| 2 | 操作モードを「結合」→「抽出」→「結合」と2回切り替える | ファイル一覧は**維持されたまま**（2件のまま）。一覧が空にならない |
| 3 | モード切替後、ドラッグ&ドロップでさらに1つPDFを追加 | 一覧に3件表示される（追加できる） |
| 4 | モード切替後、クリックで「ファイルを選択」から1つ追加 | 一覧に4件表示される（追加できる） |
| 5 | 同じファイルを連続で2回選ぶ（1回目追加→再度クリックで同じファイルを選択） | 毎回追加処理が走り、一覧に同じファイルが複数追加される（change が毎回発火する） |
| 6 | 上記操作中、DevTools Console を開いたまま操作 | エラーが出ない |

---

## 確認済み（実施時にチェック）

- [ ] 1: PDF 2つ追加 → 2件表示
- [ ] 2: モード2回切替 → file-list 維持
- [ ] 3: 切替後 D&D で追加可能
- [ ] 4: 切替後 ファイル選択で追加可能
- [ ] 5: 同一ファイル再選択で毎回追加される
- [ ] 6: Console エラーなし

---

## 変更ファイル

- `static/js/tool-runner.js`: `resetRunState()` 追加
- `templates/tools/pdf.html`: `updateModeOptions()` で `clearFiles()` → `resetRunState()`、file input change で `value = ''`、updateModeOptions 末尾で `fileInput.value = ''`
